<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="templates/template.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:s="http://seneca.neptune.sol/jsf/html">


    <ui:param name="pageTitle" value="Home"/>

    <ui:define name="content">
        <h:form>
            <div class="hero-unit">
                <h1>Heading</h1>
                <p>Tagline</p>
                <p>
                    <h:commandLink value="goto documents" styleClass="btn btn-primary btn-large" action="document/show?faces-redirect=true"/>
                    #{msg['user.created']}
                </p>
            </div>

            <s:inputText placeholder="helloworld" value="test"></s:inputText>

            #{documentManager.current}
            #{documentManager.list}




        </h:form>


        <!--<h:form enctype="multipart/form-data" id="testform">-->

            <input type="file" name="file" id="file" />
            
            <input type="file" name="mfiles" id="mfiles" multiple="multiple"/>


            <button onclick="uploadTest()">upload</button>
            
            <button onclick="multiuploadTest('mfiles')">multiupload</button>
            
            
            <br />
            
            yet another approach
            <input type="file" name="filex" id="filex" />
            <button onclick="uploadPathParam('filex')">uploadPathParam</button>
            <button onclick="uploadQueryParam('filex')">uploadQueryParam</button>
            
            <script>
               //<![CDATA[
               
               
               function uploadPathParam(id){
                   var file = document.getElementById(id).files[0];
                   
                   var filename = escape(file.name);
                    $.ajax({
                            url: "/Seneca/webresources/api/document/"+filename,
                            type: "PUT",
                            data: file,
                            processData: false,
                            contentType : "application/octet-stream"
                        });
                   
               }
               
                function uploadQueryParam(id){
                   var file = document.getElementById(id).files[0];
                   
                   var filename = escape(file.name);
                    $.ajax({
                            url: "/Seneca/webresources/api/document?filename="+filename,
                            type: "PUT",
                            data: file,
                            processData: false,
                            contentType : "application/octet-stream"
                        });
                   
               }
               
               
                function uploadTest() {
                    var file = document.getElementById('file').files[0];

                    $.ajax({
                        url: "/Seneca/webresources/api/document",
                        type: "POST",
                        data: file,
                        processData: false,
                        contentType : "application/octet-stream"
                    });
                    
                }
                
                function multiuploadTest(id) {
                    var files = document.getElementById(id).files;
                    
                    for (var i = 0; i < files.length; i++){
                        console.log(files[i]);
                    }
                    
                    uploadFiles(files, function(){console.log('done.');}, function(){});
                }
                
                function uploadFiles2(files, successCB, errorCB, currentIndex){
                    if (!files) return errorCB(); // if no files given
                    if (!currentIndex) currentIndex = 0; // init the index if not given
                    if (files.length === currentIndex) return successCB();
                    
                    var file = files[currentIndex];
                    
                    $.ajax({
                        url: "/Seneca/webresources/api/document",
                        type: "PUT",
                        data: file,
                        processData: false,
                        contentType : "application/octet-stream"
                    }).success(function(){uploadFiles(files, successCB, errorCB, currentIndex+1)});
                    
                }


                function uploadFiles(files, successCB, errorCB, currentIndex){
                    if (!files) return errorCB(); // if no files given
                    if (!currentIndex) currentIndex = 0; // init the index if not given
                    if (files.length === currentIndex) return successCB();
                    
                    var file = files[currentIndex];
                    $.ajax({
                        url: "/Seneca/webresources/api/document",
                        type: "POST",
                        data: {filename : 'test', filesize : 0}
                    }).success(function(data){
                      console.log(data);  
                        $.ajax({
                            url: "/Seneca/webresources/api/document/"+data.uploadToId+"/"+data.token,
                            type: "PUT",
                            data: file,
                            processData: false,
                            contentType : "application/octet-stream"
                        }).success(function(){uploadFiles(files, successCB, errorCB, currentIndex+1)});

                    });
                }
                
                //]]>
            </script>
        <!--</h:form>-->


    </ui:define>

</ui:composition>

